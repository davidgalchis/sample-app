{
    "components": {
        "table": {
            "type": "@dynamodb.table"
        },
        "bucket": {
            "type": "@s3.bucket"
        },
        "api": {
            "type": "@apigateway.api",
            "resources": {
                "/api/v1/access": {
                  "ANY": "@access"
                },
                "/api/v1/more_dogs": {
                  "ANY": "@unauth_api_lambda"
                },
                "/{proxy+}": {
                  "ANY": [
                    "@api_lambda:props.arn",
                    "auth"
                  ],
                  "OPTIONS": "@api_lambda:props.arn"
                }
              },
            "cors_enabled": true,
            "authorizers": {
                "auth": {
                  "lambda_arn": "@authorizer:props.arn",
                  "source": " $request.header.Authorization,$context.path,$context.httpMethod"
                }
            }
        },
        "authorizer": {
            "type": "@lambda.function",
            "description": "The authorizer for the API",
            "environment_variables": {
              "table_arn": "@table:props.arn",
              "s3_bucket_arn": "@bucket:props.arn"
            },
            "layers": [
              "@layer"
            ],
            "memory_size": 512,
            "role": "@role",
            "timeout": 30
        },
        "access": {
            "type": "@lambda.function",
            "description": "The unauthenticated access lambda for login",
            "layers": [
              "@layer"
            ],
            "memory_size": 512,
            "role": "@role",
            "timeout": 30
        },
        "api_lambda": {
            "type": "@lambda.function",
            "description": "Dogs Mobile App Logic",
            "timeout": 10,
            "role": "@role",
            "environment_variables": {
                "table_name": "@table:props.name",
                "s3_bucket_arn": "@bucket:props.arn"
            }
        },
        "unauth_api_lambda": {
            "type": "@lambda.function",
            "description": "Unauthenticated Dogs Mobile App Logic",
            "timeout": 10,
            "policies": ["@tutorial_policy"]
        },
        "role": {
            "description": "Dogs Mobile App Lambda Role",
            "policies": [
                "@policy"
            ],
            "type": "@iam.role"
        },
        "policy": {
            "description": "Dogs Mobile App Lambda Policy",
            "document": {
              "Statement": [
                {
                  "Action": [
                    "lambda:*",
                    "sqs:*",
                    "dynamodb:*",
                    "s3:*",
                    "ce:*",
                    "sts:AssumeRole"
                  ],
                  "Effect": "Allow",
                  "Resource": "*",
                  "Sid": "Vis"
                }
              ],
              "Version": "2012-10-17"
            },
            "type": "@iam.policy"
        }
    },
    "repos": {
        "iam": "https://github.com/cloudkommand/iam",
        "lambda": "https://github.com/cloudkommand/lambda",
        "dynamodb": "https://github.com/cloudkommand/dynamodb",
        "apigateway": "https://github.com/cloudkommand/apigateway",
        "reactapp": "https://github.com/cloudkommand/reactapp",
        "s3": "https://github.com/cloudkommand/s3"
    }
}